Description: 'Day 4: Serverless Architecture Stack for test'
Resources:
  UserPool6BA7E5F2:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
        - Name: verified_phone_number
          Priority: 1
        - Name: verified_email
          Priority: 2
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: false
      AutoVerifiedAttributes: []
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      Policies:
        PasswordPolicy:
          MinimumLength: 8
          RequireLowercase: true
          RequireNumbers: true
          RequireSymbols: false
          RequireUppercase: true
      Schema:
      - Mutable: true
        Name: email
        Required: false
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName: day4-user-pool-test
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: Day4Stack-test/UserPool/Resource
  UserPoolUserPoolClient40176907:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      AllowedOAuthFlows:
      - implicit
      - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
      - profile
      - phone
      - email
      - openid
      - aws.cognito.signin.user.admin
      CallbackURLs:
      - https://example.com
      ClientName: day4-client-test
      ExplicitAuthFlows:
      - ALLOW_USER_PASSWORD_AUTH
      - ALLOW_USER_SRP_AUTH
      - ALLOW_REFRESH_TOKEN_AUTH
      GenerateSecret: false
      SupportedIdentityProviders:
      - COGNITO
      UserPoolId:
        Ref: UserPool6BA7E5F2
    Metadata:
      aws:cdk:path: Day4Stack-test/UserPool/UserPoolClient/Resource
  EmployeeTable00ED18AD:
    Type: AWS::DynamoDB::GlobalTable
    Properties:
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      BillingMode: PAY_PER_REQUEST
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      Replicas:
      - PointInTimeRecoverySpecification:
          PointInTimeRecoveryEnabled: false
        Region: us-east-1
      TableName: day4-employees-test
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: Day4Stack-test/EmployeeTable/Resource
  FilesTable1399FAA4:
    Type: AWS::DynamoDB::GlobalTable
    Properties:
      AttributeDefinitions:
      - AttributeName: id
        AttributeType: S
      BillingMode: PAY_PER_REQUEST
      KeySchema:
      - AttributeName: id
        KeyType: HASH
      Replicas:
      - PointInTimeRecoverySpecification:
          PointInTimeRecoveryEnabled: false
        Region: us-east-1
      TableName: day4-files-test
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: Day4Stack-test/FilesTable/Resource
  FilesBucket16450113:
    Type: AWS::S3::Bucket
    Properties:
      CorsConfiguration:
        CorsRules:
        - AllowedHeaders:
          - '*'
          AllowedMethods:
          - GET
          - PUT
          - POST
          - DELETE
          AllowedOrigins:
          - '*'
      Tags:
      - Key: aws-cdk:auto-delete-objects
        Value: 'true'
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: Day4Stack-test/FilesBucket/Resource
  ApiFunctionServiceRole52B9747B:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRole
          Effect: Allow
          Principal:
            Service: lambda.amazonaws.com
        Version: '2012-10-17'
      ManagedPolicyArns:
      - Fn::Join:
        - ''
        - - 'arn:'
          - Ref: AWS::Partition
          - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: Day4Stack-test/ApiFunction/ServiceRole/Resource
  ApiFunctionServiceRoleDefaultPolicy20A32B8D:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
        - Action:
          - dynamodb:BatchGetItem
          - dynamodb:BatchWriteItem
          - dynamodb:ConditionCheckItem
          - dynamodb:DeleteItem
          - dynamodb:DescribeTable
          - dynamodb:GetItem
          - dynamodb:GetRecords
          - dynamodb:GetShardIterator
          - dynamodb:PutItem
          - dynamodb:Query
          - dynamodb:Scan
          - dynamodb:UpdateItem
          Effect: Allow
          Resource:
          - Fn::GetAtt:
            - EmployeeTable00ED18AD
            - Arn
          - Fn::GetAtt:
            - FilesTable1399FAA4
            - Arn
        - Action:
          - s3:Abort*
          - s3:DeleteObject*
          - s3:GetBucket*
          - s3:GetObject*
          - s3:List*
          - s3:PutObject
          - s3:PutObjectLegalHold
          - s3:PutObjectRetention
          - s3:PutObjectTagging
          - s3:PutObjectVersionTagging
          Effect: Allow
          Resource:
          - Fn::GetAtt:
            - FilesBucket16450113
            - Arn
          - Fn::Join:
            - ''
            - - Fn::GetAtt:
                - FilesBucket16450113
                - Arn
              - /*
        Version: '2012-10-17'
      PolicyName: ApiFunctionServiceRoleDefaultPolicy20A32B8D
      Roles:
      - Ref: ApiFunctionServiceRole52B9747B
    Metadata:
      aws:cdk:path: Day4Stack-test/ApiFunction/ServiceRole/DefaultPolicy/Resource
  ApiFunctionCE271BD4:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: LambdaCodeBucket
        S3Key: api.zip
      Environment:
        Variables:
          EMPLOYEE_TABLE_NAME:
            Ref: EmployeeTable00ED18AD
          FILES_TABLE_NAME:
            Ref: FilesTable1399FAA4
          FILES_BUCKET_NAME:
            Ref: FilesBucket16450113
          USER_POOL_ID:
            Ref: UserPool6BA7E5F2
          USER_POOL_CLIENT_ID:
            Ref: UserPoolUserPoolClient40176907
      FunctionName: day4-api-test
      Handler: index.handler
      MemorySize: 512
      Role:
        Fn::GetAtt:
        - ApiFunctionServiceRole52B9747B
        - Arn
      Runtime: nodejs22.x
      Timeout: 30
    DependsOn:
    - ApiFunctionServiceRoleDefaultPolicy20A32B8D
    - ApiFunctionServiceRole52B9747B
    Metadata:
      aws:cdk:path: Day4Stack-test/ApiFunction/Resource
  ApiF70053CD:
    Type: AWS::ApiGateway::RestApi
    Properties:
      Description: Day 4 Serverless API
      Name: day4-api-test
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Resource
  ApiDeploymentB17BE62Daab59250a30cd6de3cb3ff75b515db7d:
    Type: AWS::ApiGateway::Deployment
    Properties:
      Description: Day 4 Serverless API
      RestApiId:
        Ref: ApiF70053CD
    DependsOn:
    - ApiauthOPTIONSC18B26B2
    - Apiauth161C653C
    - ApiauthsigninOPTIONSA3B32D66
    - ApiauthsigninPOST5928E62B
    - ApiauthsigninAE03C205
    - ApiauthsignupOPTIONS52BF1977
    - ApiauthsignupPOST0DD6DBB2
    - Apiauthsignup5EC2C73B
    - ApiemployeesidDELETE3ABC181E
    - ApiemployeesidGET61D3F36D
    - ApiemployeesidOPTIONS4A1A4FB6
    - ApiemployeesidPUTC5287713
    - Apiemployeesid9DE89836
    - ApiemployeesGET67F84577
    - ApiemployeesOPTIONS4695960E
    - ApiemployeesPOSTEEC6833C
    - ApiemployeesBDE3A47D
    - ApifilesidDELETEEEF249FC
    - ApifilesiddownloadurlGET6815F828
    - ApifilesiddownloadurlOPTIONSA6F89564
    - Apifilesiddownloadurl428185E1
    - ApifilesidOPTIONS973C477D
    - ApifilesidE2F554CA
    - ApifilesGETC83361F1
    - ApifilesOPTIONSB123E843
    - ApifilesPOSTA30CB5E4
    - Apifiles65E09967
    - ApifilesuploadurlOPTIONS10652658
    - ApifilesuploadurlPOST48346BA9
    - Apifilesuploadurl20351039
    - ApiOPTIONS5886EA5D
    - AuthorizerBD825682
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Deployment/Resource
      aws:cdk:do-not-refactor: true
  ApiDeploymentStageprod3EB9684E:
    Type: AWS::ApiGateway::Stage
    Properties:
      DeploymentId:
        Ref: ApiDeploymentB17BE62Daab59250a30cd6de3cb3ff75b515db7d
      MethodSettings:
      - DataTraceEnabled: false
        HttpMethod: '*'
        ResourcePath: /*
        ThrottlingBurstLimit: 200
        ThrottlingRateLimit: 100
      RestApiId:
        Ref: ApiF70053CD
      StageName: prod
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/DeploymentStage.prod/Resource
  ApiOPTIONS5886EA5D:
    Type: AWS::ApiGateway::Method
    Properties:
      ApiKeyRequired: false
      AuthorizationType: NONE
      HttpMethod: OPTIONS
      Integration:
        IntegrationResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
            method.response.header.Access-Control-Allow-Origin: '''*'''
            method.response.header.Access-Control-Allow-Methods: '''OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'''
          StatusCode: '204'
        RequestTemplates:
          application/json: '{ statusCode: 200 }'
        Type: MOCK
      MethodResponses:
      - ResponseParameters:
          method.response.header.Access-Control-Allow-Headers: true
          method.response.header.Access-Control-Allow-Origin: true
          method.response.header.Access-Control-Allow-Methods: true
        StatusCode: '204'
      ResourceId:
        Fn::GetAtt:
        - ApiF70053CD
        - RootResourceId
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/OPTIONS/Resource
  Apiauth161C653C:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Fn::GetAtt:
        - ApiF70053CD
        - RootResourceId
      PathPart: auth
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/Resource
  ApiauthOPTIONSC18B26B2:
    Type: AWS::ApiGateway::Method
    Properties:
      ApiKeyRequired: false
      AuthorizationType: NONE
      HttpMethod: OPTIONS
      Integration:
        IntegrationResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
            method.response.header.Access-Control-Allow-Origin: '''*'''
            method.response.header.Access-Control-Allow-Methods: '''OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'''
          StatusCode: '204'
        RequestTemplates:
          application/json: '{ statusCode: 200 }'
        Type: MOCK
      MethodResponses:
      - ResponseParameters:
          method.response.header.Access-Control-Allow-Headers: true
          method.response.header.Access-Control-Allow-Origin: true
          method.response.header.Access-Control-Allow-Methods: true
        StatusCode: '204'
      ResourceId:
        Ref: Apiauth161C653C
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/OPTIONS/Resource
  Apiauthsignup5EC2C73B:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: Apiauth161C653C
      PathPart: signup
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/signup/Resource
  ApiauthsignupOPTIONS52BF1977:
    Type: AWS::ApiGateway::Method
    Properties:
      ApiKeyRequired: false
      AuthorizationType: NONE
      HttpMethod: OPTIONS
      Integration:
        IntegrationResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
            method.response.header.Access-Control-Allow-Origin: '''*'''
            method.response.header.Access-Control-Allow-Methods: '''OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'''
          StatusCode: '204'
        RequestTemplates:
          application/json: '{ statusCode: 200 }'
        Type: MOCK
      MethodResponses:
      - ResponseParameters:
          method.response.header.Access-Control-Allow-Headers: true
          method.response.header.Access-Control-Allow-Origin: true
          method.response.header.Access-Control-Allow-Methods: true
        StatusCode: '204'
      ResourceId:
        Ref: Apiauthsignup5EC2C73B
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/signup/OPTIONS/Resource
  ApiauthsignupPOSTApiPermissionDay4StacktestApiCDAFC29FPOSTauthsignupBCB546AE:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /POST/auth/signup
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/signup/POST/ApiPermission.Day4StacktestApiCDAFC29F.POST..auth.signup
  ApiauthsignupPOSTApiPermissionTestDay4StacktestApiCDAFC29FPOSTauthsignup043880B4:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/POST/auth/signup
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/signup/POST/ApiPermission.Test.Day4StacktestApiCDAFC29F.POST..auth.signup
  ApiauthsignupPOST0DD6DBB2:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: NONE
      HttpMethod: POST
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: Apiauthsignup5EC2C73B
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/signup/POST/Resource
  ApiauthsigninAE03C205:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: Apiauth161C653C
      PathPart: signin
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/signin/Resource
  ApiauthsigninOPTIONSA3B32D66:
    Type: AWS::ApiGateway::Method
    Properties:
      ApiKeyRequired: false
      AuthorizationType: NONE
      HttpMethod: OPTIONS
      Integration:
        IntegrationResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
            method.response.header.Access-Control-Allow-Origin: '''*'''
            method.response.header.Access-Control-Allow-Methods: '''OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'''
          StatusCode: '204'
        RequestTemplates:
          application/json: '{ statusCode: 200 }'
        Type: MOCK
      MethodResponses:
      - ResponseParameters:
          method.response.header.Access-Control-Allow-Headers: true
          method.response.header.Access-Control-Allow-Origin: true
          method.response.header.Access-Control-Allow-Methods: true
        StatusCode: '204'
      ResourceId:
        Ref: ApiauthsigninAE03C205
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/signin/OPTIONS/Resource
  ApiauthsigninPOSTApiPermissionDay4StacktestApiCDAFC29FPOSTauthsignin04D1449C:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /POST/auth/signin
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/signin/POST/ApiPermission.Day4StacktestApiCDAFC29F.POST..auth.signin
  ApiauthsigninPOSTApiPermissionTestDay4StacktestApiCDAFC29FPOSTauthsignin1AB3B94A:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/POST/auth/signin
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/signin/POST/ApiPermission.Test.Day4StacktestApiCDAFC29F.POST..auth.signin
  ApiauthsigninPOST5928E62B:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: NONE
      HttpMethod: POST
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: ApiauthsigninAE03C205
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/auth/signin/POST/Resource
  ApiemployeesBDE3A47D:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Fn::GetAtt:
        - ApiF70053CD
        - RootResourceId
      PathPart: employees
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/Resource
  ApiemployeesOPTIONS4695960E:
    Type: AWS::ApiGateway::Method
    Properties:
      ApiKeyRequired: false
      AuthorizationType: NONE
      HttpMethod: OPTIONS
      Integration:
        IntegrationResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
            method.response.header.Access-Control-Allow-Origin: '''*'''
            method.response.header.Access-Control-Allow-Methods: '''OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'''
          StatusCode: '204'
        RequestTemplates:
          application/json: '{ statusCode: 200 }'
        Type: MOCK
      MethodResponses:
      - ResponseParameters:
          method.response.header.Access-Control-Allow-Headers: true
          method.response.header.Access-Control-Allow-Origin: true
          method.response.header.Access-Control-Allow-Methods: true
        StatusCode: '204'
      ResourceId:
        Ref: ApiemployeesBDE3A47D
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/OPTIONS/Resource
  ApiemployeesGETApiPermissionDay4StacktestApiCDAFC29FGETemployees47AC448D:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /GET/employees
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/GET/ApiPermission.Day4StacktestApiCDAFC29F.GET..employees
  ApiemployeesGETApiPermissionTestDay4StacktestApiCDAFC29FGETemployees07528236:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/GET/employees
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/GET/ApiPermission.Test.Day4StacktestApiCDAFC29F.GET..employees
  ApiemployeesGET67F84577:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: AuthorizerBD825682
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: ApiemployeesBDE3A47D
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/GET/Resource
  ApiemployeesPOSTApiPermissionDay4StacktestApiCDAFC29FPOSTemployees1239E1D1:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /POST/employees
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/POST/ApiPermission.Day4StacktestApiCDAFC29F.POST..employees
  ApiemployeesPOSTApiPermissionTestDay4StacktestApiCDAFC29FPOSTemployeesACBB2006:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/POST/employees
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/POST/ApiPermission.Test.Day4StacktestApiCDAFC29F.POST..employees
  ApiemployeesPOSTEEC6833C:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: AuthorizerBD825682
      HttpMethod: POST
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: ApiemployeesBDE3A47D
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/POST/Resource
  Apiemployeesid9DE89836:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: ApiemployeesBDE3A47D
      PathPart: '{id}'
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/Resource
  ApiemployeesidOPTIONS4A1A4FB6:
    Type: AWS::ApiGateway::Method
    Properties:
      ApiKeyRequired: false
      AuthorizationType: NONE
      HttpMethod: OPTIONS
      Integration:
        IntegrationResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
            method.response.header.Access-Control-Allow-Origin: '''*'''
            method.response.header.Access-Control-Allow-Methods: '''OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'''
          StatusCode: '204'
        RequestTemplates:
          application/json: '{ statusCode: 200 }'
        Type: MOCK
      MethodResponses:
      - ResponseParameters:
          method.response.header.Access-Control-Allow-Headers: true
          method.response.header.Access-Control-Allow-Origin: true
          method.response.header.Access-Control-Allow-Methods: true
        StatusCode: '204'
      ResourceId:
        Ref: Apiemployeesid9DE89836
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/OPTIONS/Resource
  ApiemployeesidGETApiPermissionDay4StacktestApiCDAFC29FGETemployeesidFE0A30EF:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /GET/employees/*
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/GET/ApiPermission.Day4StacktestApiCDAFC29F.GET..employees.{id}
  ApiemployeesidGETApiPermissionTestDay4StacktestApiCDAFC29FGETemployeesid62B6AADF:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/GET/employees/*
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/GET/ApiPermission.Test.Day4StacktestApiCDAFC29F.GET..employees.{id}
  ApiemployeesidGET61D3F36D:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: AuthorizerBD825682
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: Apiemployeesid9DE89836
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/GET/Resource
  ApiemployeesidPUTApiPermissionDay4StacktestApiCDAFC29FPUTemployeesidB5C32399:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /PUT/employees/*
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/PUT/ApiPermission.Day4StacktestApiCDAFC29F.PUT..employees.{id}
  ApiemployeesidPUTApiPermissionTestDay4StacktestApiCDAFC29FPUTemployeesidF543045F:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/PUT/employees/*
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/PUT/ApiPermission.Test.Day4StacktestApiCDAFC29F.PUT..employees.{id}
  ApiemployeesidPUTC5287713:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: AuthorizerBD825682
      HttpMethod: PUT
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: Apiemployeesid9DE89836
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/PUT/Resource
  ApiemployeesidDELETEApiPermissionDay4StacktestApiCDAFC29FDELETEemployeesidE0C7627C:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /DELETE/employees/*
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/DELETE/ApiPermission.Day4StacktestApiCDAFC29F.DELETE..employees.{id}
  ApiemployeesidDELETEApiPermissionTestDay4StacktestApiCDAFC29FDELETEemployeesid12EFB947:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/DELETE/employees/*
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/DELETE/ApiPermission.Test.Day4StacktestApiCDAFC29F.DELETE..employees.{id}
  ApiemployeesidDELETE3ABC181E:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: AuthorizerBD825682
      HttpMethod: DELETE
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: Apiemployeesid9DE89836
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/employees/{id}/DELETE/Resource
  Apifiles65E09967:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Fn::GetAtt:
        - ApiF70053CD
        - RootResourceId
      PathPart: files
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/Resource
  ApifilesOPTIONSB123E843:
    Type: AWS::ApiGateway::Method
    Properties:
      ApiKeyRequired: false
      AuthorizationType: NONE
      HttpMethod: OPTIONS
      Integration:
        IntegrationResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
            method.response.header.Access-Control-Allow-Origin: '''*'''
            method.response.header.Access-Control-Allow-Methods: '''OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'''
          StatusCode: '204'
        RequestTemplates:
          application/json: '{ statusCode: 200 }'
        Type: MOCK
      MethodResponses:
      - ResponseParameters:
          method.response.header.Access-Control-Allow-Headers: true
          method.response.header.Access-Control-Allow-Origin: true
          method.response.header.Access-Control-Allow-Methods: true
        StatusCode: '204'
      ResourceId:
        Ref: Apifiles65E09967
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/OPTIONS/Resource
  ApifilesGETApiPermissionDay4StacktestApiCDAFC29FGETfilesF6B7E313:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /GET/files
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/GET/ApiPermission.Day4StacktestApiCDAFC29F.GET..files
  ApifilesGETApiPermissionTestDay4StacktestApiCDAFC29FGETfiles67CD602A:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/GET/files
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/GET/ApiPermission.Test.Day4StacktestApiCDAFC29F.GET..files
  ApifilesGETC83361F1:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: AuthorizerBD825682
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: Apifiles65E09967
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/GET/Resource
  ApifilesPOSTApiPermissionDay4StacktestApiCDAFC29FPOSTfiles691D0440:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /POST/files
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/POST/ApiPermission.Day4StacktestApiCDAFC29F.POST..files
  ApifilesPOSTApiPermissionTestDay4StacktestApiCDAFC29FPOSTfilesF8E2E5F3:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/POST/files
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/POST/ApiPermission.Test.Day4StacktestApiCDAFC29F.POST..files
  ApifilesPOSTA30CB5E4:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: AuthorizerBD825682
      HttpMethod: POST
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: Apifiles65E09967
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/POST/Resource
  Apifilesuploadurl20351039:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: Apifiles65E09967
      PathPart: upload-url
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/upload-url/Resource
  ApifilesuploadurlOPTIONS10652658:
    Type: AWS::ApiGateway::Method
    Properties:
      ApiKeyRequired: false
      AuthorizationType: NONE
      HttpMethod: OPTIONS
      Integration:
        IntegrationResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
            method.response.header.Access-Control-Allow-Origin: '''*'''
            method.response.header.Access-Control-Allow-Methods: '''OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'''
          StatusCode: '204'
        RequestTemplates:
          application/json: '{ statusCode: 200 }'
        Type: MOCK
      MethodResponses:
      - ResponseParameters:
          method.response.header.Access-Control-Allow-Headers: true
          method.response.header.Access-Control-Allow-Origin: true
          method.response.header.Access-Control-Allow-Methods: true
        StatusCode: '204'
      ResourceId:
        Ref: Apifilesuploadurl20351039
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/upload-url/OPTIONS/Resource
  ApifilesuploadurlPOSTApiPermissionDay4StacktestApiCDAFC29FPOSTfilesuploadurl66ED460C:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /POST/files/upload-url
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/upload-url/POST/ApiPermission.Day4StacktestApiCDAFC29F.POST..files.upload-url
  ApifilesuploadurlPOSTApiPermissionTestDay4StacktestApiCDAFC29FPOSTfilesuploadurlD62BAD60:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/POST/files/upload-url
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/upload-url/POST/ApiPermission.Test.Day4StacktestApiCDAFC29F.POST..files.upload-url
  ApifilesuploadurlPOST48346BA9:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: AuthorizerBD825682
      HttpMethod: POST
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: Apifilesuploadurl20351039
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/upload-url/POST/Resource
  ApifilesidE2F554CA:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: Apifiles65E09967
      PathPart: '{id}'
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/{id}/Resource
  ApifilesidOPTIONS973C477D:
    Type: AWS::ApiGateway::Method
    Properties:
      ApiKeyRequired: false
      AuthorizationType: NONE
      HttpMethod: OPTIONS
      Integration:
        IntegrationResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
            method.response.header.Access-Control-Allow-Origin: '''*'''
            method.response.header.Access-Control-Allow-Methods: '''OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'''
          StatusCode: '204'
        RequestTemplates:
          application/json: '{ statusCode: 200 }'
        Type: MOCK
      MethodResponses:
      - ResponseParameters:
          method.response.header.Access-Control-Allow-Headers: true
          method.response.header.Access-Control-Allow-Origin: true
          method.response.header.Access-Control-Allow-Methods: true
        StatusCode: '204'
      ResourceId:
        Ref: ApifilesidE2F554CA
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/{id}/OPTIONS/Resource
  ApifilesidDELETEApiPermissionDay4StacktestApiCDAFC29FDELETEfilesid766130A7:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /DELETE/files/*
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/{id}/DELETE/ApiPermission.Day4StacktestApiCDAFC29F.DELETE..files.{id}
  ApifilesidDELETEApiPermissionTestDay4StacktestApiCDAFC29FDELETEfilesid7FB971B1:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/DELETE/files/*
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/{id}/DELETE/ApiPermission.Test.Day4StacktestApiCDAFC29F.DELETE..files.{id}
  ApifilesidDELETEEEF249FC:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: AuthorizerBD825682
      HttpMethod: DELETE
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: ApifilesidE2F554CA
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/{id}/DELETE/Resource
  Apifilesiddownloadurl428185E1:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: ApifilesidE2F554CA
      PathPart: download-url
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/{id}/download-url/Resource
  ApifilesiddownloadurlOPTIONSA6F89564:
    Type: AWS::ApiGateway::Method
    Properties:
      ApiKeyRequired: false
      AuthorizationType: NONE
      HttpMethod: OPTIONS
      Integration:
        IntegrationResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: '''Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'''
            method.response.header.Access-Control-Allow-Origin: '''*'''
            method.response.header.Access-Control-Allow-Methods: '''OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'''
          StatusCode: '204'
        RequestTemplates:
          application/json: '{ statusCode: 200 }'
        Type: MOCK
      MethodResponses:
      - ResponseParameters:
          method.response.header.Access-Control-Allow-Headers: true
          method.response.header.Access-Control-Allow-Origin: true
          method.response.header.Access-Control-Allow-Methods: true
        StatusCode: '204'
      ResourceId:
        Ref: Apifilesiddownloadurl428185E1
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/{id}/download-url/OPTIONS/Resource
  ApifilesiddownloadurlGETApiPermissionDay4StacktestApiCDAFC29FGETfilesiddownloadurl5E406FAA:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /
          - Ref: ApiDeploymentStageprod3EB9684E
          - /GET/files/*/download-url
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/{id}/download-url/GET/ApiPermission.Day4StacktestApiCDAFC29F.GET..files.{id}.download-url
  ApifilesiddownloadurlGETApiPermissionTestDay4StacktestApiCDAFC29FGETfilesiddownloadurlE81FE96C:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
        - ApiFunctionCE271BD4
        - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
        - ''
        - - 'arn:aws:execute-api:us-east-1:'
          - Ref: AWS::AccountId
          - ':'
          - Ref: ApiF70053CD
          - /test-invoke-stage/GET/files/*/download-url
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/{id}/download-url/GET/ApiPermission.Test.Day4StacktestApiCDAFC29F.GET..files.{id}.download-url
  ApifilesiddownloadurlGET6815F828:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: AuthorizerBD825682
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
          - ''
          - - arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/
            - Fn::GetAtt:
              - ApiFunctionCE271BD4
              - Arn
            - /invocations
      ResourceId:
        Ref: Apifilesiddownloadurl428185E1
      RestApiId:
        Ref: ApiF70053CD
    Metadata:
      aws:cdk:path: Day4Stack-test/Api/Default/files/{id}/download-url/GET/Resource
  AuthorizerBD825682:
    Type: AWS::ApiGateway::Authorizer
    Properties:
      IdentitySource: method.request.header.Authorization
      Name: day4-authorizer-test
      ProviderARNs:
      - Fn::GetAtt:
        - UserPool6BA7E5F2
        - Arn
      RestApiId:
        Ref: ApiF70053CD
      Type: COGNITO_USER_POOLS
    Metadata:
      aws:cdk:path: Day4Stack-test/Authorizer/Resource
  WebsiteBucket75C24D94:
    Type: AWS::S3::Bucket
    Properties:
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      Tags:
      - Key: aws-cdk:auto-delete-objects
        Value: 'true'
      - Key: aws-cdk:cr-owned:7c546340
        Value: 'true'
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: Day4Stack-test/WebsiteBucket/Resource
  WebsiteBucketPolicyE10E3262:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket:
        Ref: WebsiteBucket75C24D94
      PolicyDocument:
        Statement:
        - Action: s3:GetObject
          Condition:
            StringEquals:
              AWS:SourceArn:
                Fn::Join:
                - ''
                - - 'arn:'
                  - Ref: AWS::Partition
                  - ':cloudfront::'
                  - Ref: AWS::AccountId
                  - :distribution/
                  - Ref: Distribution830FAC52
          Effect: Allow
          Principal:
            Service: cloudfront.amazonaws.com
          Resource:
            Fn::Join:
            - ''
            - - Fn::GetAtt:
                - WebsiteBucket75C24D94
                - Arn
              - /*
        Version: '2012-10-17'
    Metadata:
      aws:cdk:path: Day4Stack-test/WebsiteBucket/Policy/Resource
  DistributionOrigin1S3OriginAccessControlEB606076:
    Type: AWS::CloudFront::OriginAccessControl
    Properties:
      OriginAccessControlConfig:
        Name: Day4StacktestDistributionOrigin1S3OriginAccessControl09F1D1DF
        OriginAccessControlOriginType: s3
        SigningBehavior: always
        SigningProtocol: sigv4
    Metadata:
      aws:cdk:path: Day4Stack-test/Distribution/Origin1/S3OriginAccessControl/Resource
  Distribution830FAC52:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        Comment: Day 4 CloudFront Distribution for test
        CustomErrorResponses:
        - ErrorCachingMinTTL: 300
          ErrorCode: 404
          ResponseCode: 200
          ResponsePagePath: /index.html
        DefaultCacheBehavior:
          AllowedMethods:
          - GET
          - HEAD
          CachePolicyId: 658327ea-f89d-4fab-a63d-7e88639e58f6
          CachedMethods:
          - GET
          - HEAD
          Compress: true
          TargetOriginId: Day4StacktestDistributionOrigin1F98B7708
          ViewerProtocolPolicy: redirect-to-https
        DefaultRootObject: index.html
        Enabled: true
        HttpVersion: http2
        IPV6Enabled: true
        Origins:
        - DomainName:
            Fn::GetAtt:
            - WebsiteBucket75C24D94
            - RegionalDomainName
          Id: Day4StacktestDistributionOrigin1F98B7708
          OriginAccessControlId:
            Fn::GetAtt:
            - DistributionOrigin1S3OriginAccessControlEB606076
            - Id
          S3OriginConfig:
            OriginAccessIdentity: ''
    Metadata:
      aws:cdk:path: Day4Stack-test/Distribution/Resource
Outputs:
  ApiEndpoint4F160690:
    Value:
      Fn::Join:
      - ''
      - - https://
        - Ref: ApiF70053CD
        - .execute-api.us-east-1.
        - Ref: AWS::URLSuffix
        - /
        - Ref: ApiDeploymentStageprod3EB9684E
        - /
  UserPoolId:
    Description: Cognito User Pool ID
    Value:
      Ref: UserPool6BA7E5F2
  UserPoolClientId:
    Description: Cognito User Pool Client ID
    Value:
      Ref: UserPoolUserPoolClient40176907
  ApiUrl:
    Description: API Gateway URL
    Value:
      Fn::Join:
      - ''
      - - https://
        - Ref: ApiF70053CD
        - .execute-api.us-east-1.
        - Ref: AWS::URLSuffix
        - /
        - Ref: ApiDeploymentStageprod3EB9684E
        - /
  CloudFrontUrl:
    Description: CloudFront Distribution URL
    Value:
      Fn::Join:
      - ''
      - - https://
        - Fn::GetAtt:
          - Distribution830FAC52
          - DomainName
  EmployeeTableName:
    Description: DynamoDB Employee Table Name
    Value:
      Ref: EmployeeTable00ED18AD
  FilesTableName:
    Description: DynamoDB Files Table Name
    Value:
      Ref: FilesTable1399FAA4
  FilesBucketName:
    Description: S3 Files Bucket Name
    Value:
      Ref: FilesBucket16450113
  WebsiteBucketName:
    Description: S3 Website Bucket Name (for frontend)
    Value:
      Ref: WebsiteBucket75C24D94
Parameters:
  LambdaCodeBucket:
    Type: String
    Description: S3 bucket containing Lambda deployment packages (api.zip)
